<!DOCTYPE html>
<html>
<head>
    <title>Convex Hull Visualizer</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #1e1e1e; color: #fff; }
        #canvas { border: 2px solid #444; background: #2d2d2d; cursor: crosshair; }
        button { margin: 5px; padding: 8px 16px; cursor: pointer; }
        #results { margin-top: 10px; font-family: monospace; white-space: pre; }
        .row { display: flex; gap: 20px; align-items: flex-start; }
        input[type="number"] { width: 80px; padding: 5px; }
        .toggle-group { margin: 10px 0; display: flex; gap: 15px; align-items: center; }
        .toggle-group label { display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .toggle-group input[type="checkbox"] { width: 16px; height: 16px; cursor: pointer; }
        .graham-label { color: #4caf50; }
        .dc-label { color: #ff9800; }
    </style>
</head>
<body>
    <h2>Convex Hull - Draw or Generate Points</h2>
    <div class="row">
        <div>
            <canvas id="canvas" width="600" height="500"></canvas>
            <div>
                <button onclick="clear_all()">Clear</button>
                <button onclick="compute()">Compute Hull</button>
                <button onclick="generate()">Random</button>
                <input type="number" id="npts" value="50" min="3">
                <button onclick="exportPts()">Export</button>
                <button onclick="importPts()">Import</button>
            </div>
            <div class="toggle-group">
                <span>Show:</span>
                <label class="graham-label">
                    <input type="checkbox" id="showGraham" checked onchange="draw()"> Graham Scan
                </label>
                <label class="dc-label">
                    <input type="checkbox" id="showDC" checked onchange="draw()"> Divide & Conquer
                </label>
            </div>
        </div>
        <div id="results"></div>
    </div>
    <script>
const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
let points = [], hull_graham = [], hull_dc = [];

canvas.onclick = e => {
    const r = canvas.getBoundingClientRect();
    points.push([e.clientX - r.left, e.clientY - r.top]);
    draw();
};

function draw() {
    ctx.fillStyle = '#2d2d2d'; ctx.fillRect(0, 0, 600, 500);
    ctx.fillStyle = '#4fc3f7';
    points.forEach(p => { ctx.beginPath(); ctx.arc(p[0], p[1], 4, 0, Math.PI*2); ctx.fill(); });
    
    const showGraham = document.getElementById('showGraham').checked;
    const showDC = document.getElementById('showDC').checked;
    
    if (showGraham && hull_graham.length > 1) drawHull(hull_graham, '#4caf50', 2);
    if (showDC && hull_dc.length > 1) drawHull(hull_dc, '#ff9800', 4);
}

function drawHull(hull, color, width) {
    ctx.strokeStyle = color; ctx.lineWidth = width; ctx.beginPath();
    ctx.moveTo(hull[0][0], hull[0][1]);
    hull.forEach(p => ctx.lineTo(p[0], p[1]));
    ctx.closePath(); ctx.stroke();
}

async function compute() {
    if (points.length < 3) {
        document.getElementById('results').textContent = 'Need at least 3 points';
        return;
    }
    
    try {
        const response = await fetch('http://localhost:8000/compute', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(points)
        });
        
        if (!response.ok) throw new Error('Server error');
        
        const result = await response.json();
        
        hull_graham = result.graham.hull;
        hull_dc = result.divide_conquer.hull;
        
        document.getElementById('results').textContent = 
            `Points: ${points.length}\n\nGraham (green): ${result.graham.time_ms.toFixed(3)}ms, hull=${hull_graham.length}\nD&C (orange):   ${result.divide_conquer.time_ms.toFixed(3)}ms, hull=${hull_dc.length}`;
        draw();
    } catch (e) {
        document.getElementById('results').textContent = 'Error: Make sure server.py is running\n(python server.py)';
    }
}

function generate() {
    const n = parseInt(document.getElementById('npts').value) || 50;
    points = Array.from({length: n}, () => [Math.random()*560+20, Math.random()*460+20]);
    hull_graham = []; hull_dc = []; draw();
}

function clear_all() { points = []; hull_graham = []; hull_dc = []; draw(); document.getElementById('results').textContent = ''; }

function exportPts() { navigator.clipboard.writeText(JSON.stringify(points)); alert('Copied to clipboard!'); }

function importPts() {
    const s = prompt('Paste points JSON:');
    if (s) try { points = JSON.parse(s); hull_graham = []; hull_dc = []; draw(); } catch(e) { alert('Invalid JSON'); }
}

draw();
    </script>
</body>
</html>
